<main class="profile-page">
  <%- include('../partials/donorSidebar') %>

  <div id="main-wrapper">
    <div class="glass-bar d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
      <div class="d-flex align-items-center gap-3">
        <button id="sidebar-toggler-btn" class="btn btn-icon btn-outline-light border-0 shadow-sm" aria-label="Toggle sidebar">
          <i class="fas fa-bars"></i>
        </button>
        <h5 class="m-0 fw-bold text-white">Profile</h5>
      </div>
      <a href="/donor/donate" class="btn btn-accent btn-sm fw-semibold"><i class="fas fa-gift me-1"></i> Donate</a>
    </div>

    <div class="row g-4 mx-3 mb-5">
      <div class="col-lg-4">
        <div class="panel h-100 d-flex flex-column justify-content-between">
          <div>
            <div class="text-center mb-3">
              <div class="avatar-lg mx-auto mb-3"><%= (currentUser.firstName||'U')[0].toUpperCase() %></div>
              <h6 class="fw-semibold mb-1"><%= currentUser.firstName + ' ' + currentUser.lastName %></h6>
              <div class="small text-muted mb-2"><%= currentUser.email %></div>
              <span class="badge bg-primary-subtle text-primary-emphasis small px-3 py-1 rounded-pill">Donor</span>
            </div>
            <ul class="list-unstyled small mb-0 profile-meta">
              <li><i class="fas fa-map-marker-alt me-2 text-danger"></i><span><%= currentUser.address || 'Address not set' %></span></li>
              <li><i class="fas fa-phone me-2 text-success"></i><span><%= currentUser.phone || 'Phone not set' %></span></li>
              <li><i class="fas fa-venus-mars me-2 text-info"></i><span><%= currentUser.gender || 'N/A' %></span></li>
            </ul>
          </div>
          <div class="mt-4">
            <div class="alert alert-info small mb-2">
              <i class="fas fa-info-circle me-1"></i> Keep details updated for faster coordination.
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-8">
        <form action="/donor/profile?_method=PUT" method="POST" class="panel">
          <div class="panel-header mb-3">
            <h6 class="panel-title mb-1">Edit Details</h6>
            <p class="small text-muted mb-0">Update only fields that changed.</p>
          </div>

          <div class="row g-4">
            <div class="col-md-6">
              <label for="first-name" class="form-label small fw-semibold text-uppercase">First Name</label>
              <input type="text" name="donor[firstName]" class="form-control" id="first-name" value="<%= currentUser.firstName %>" required>
            </div>
            <div class="col-md-6">
              <label for="last-name" class="form-label small fw-semibold text-uppercase">Last Name</label>
              <input type="text" name="donor[lastName]" class="form-control" id="last-name" value="<%= currentUser.lastName %>" required>
            </div>
            <div class="col-md-6">
              <label class="form-label small fw-semibold text-uppercase">Email</label>
              <input type="email" class="form-control" value="<%= currentUser.email %>" disabled>
            </div>
            <div class="col-md-6">
              <label for="phone" class="form-label small fw-semibold text-uppercase">Phone</label>
              <input type="tel" pattern="^[0-9 +()-]{7,}$" name="donor[phone]" class="form-control" id="phone" value="<%= currentUser.phone %>">
            </div>

            <div class="col-md-12">
              <label for="address" class="form-label small fw-semibold text-uppercase">Address</label>
              <input type="text" name="donor[address]" class="form-control" id="address" value="<%= currentUser.address %>">
            </div>

            <div class="col-md-12">
              <span class="d-block form-label small fw-semibold text-uppercase mb-2">Gender</span>
              <div class="d-flex gap-4">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="donor[gender]" id="male" value="male" <%= currentUser.gender==='male'?'checked':'' %>>
                  <label class="form-check-label" for="male">Male</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="donor[gender]" id="female" value="female" <%= currentUser.gender==='female'?'checked':'' %>>
                  <label class="form-check-label" for="female">Female</label>
                </div>
              </div>
            </div>
			<div class="col-md-12 mt-3">
				<div class="d-flex justify-content-end">
					<button type="submit" class="btn btn-primary px-4">
					<i class="fas fa-save me-2"></i>Save Changes
					</button>
				</div>
			</div>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<style>
  .profile-page { background:linear-gradient(135deg,#0d6efd,#198754); min-height:100vh; display:flex; }
  .glass-bar { background:rgba(255,255,255,.09); border:1px solid rgba(255,255,255,.15); backdrop-filter:blur(12px); border-radius:1.1rem; padding:.85rem 1.2rem; margin:1rem 1rem 0; }
  .panel { background:#fff; border:1px solid #eef1f4; border-radius:1.15rem; padding:1.4rem 1.4rem 1.7rem; box-shadow:0 .55rem 1.5rem -0.75rem rgba(0,0,0,.18); position:relative; }
  .panel:before { content:""; position:absolute; inset:0; background:radial-gradient(circle at 92% 12%,rgba(0,0,0,.04),transparent 55%); pointer-events:none; }
  .panel-title { font-weight:600; }
  .avatar-lg { width:92px; height:92px; border-radius:22px; background:linear-gradient(135deg,#ffc107,#ffdd57); display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:700; color:#2d3436; box-shadow:0 0 0 5px rgba(255,255,255,.65),0 .5rem 1.25rem -0.5rem rgba(0,0,0,.35); }
  .profile-meta li { margin-bottom:.55rem; display:flex; align-items:flex-start; }
  .btn-accent { background:#ffc107; border:none; color:#212529; }
  .btn-accent:hover { background:#ffca2c; }
  @media (max-width: 991.98px){ .avatar-lg { width:78px; height:78px; font-size:1.6rem; } }
</style>

<script>
(function(){
  const toggler=document.getElementById('sidebar-toggler-btn');
  if(toggler) toggler.addEventListener('click',()=> document.body.classList.toggle('sidebar-collapsed'));
})();
</script>