<main class="agent-collection">
  <%- include('../partials/agentSidebar') %>
  <div id="main-wrapper">

    <!-- Top Bar -->
    <div class="bg-white shadow-sm d-flex align-items-center justify-content-between px-3 py-2 top-bar">
      <div class="d-flex align-items-center gap-3">
        <button id="sidebar-toggler-btn" class="btn btn-outline-primary btn-sm"><i class="fas fa-bars"></i></button>
        <h5 class="m-0 fw-semibold text-primary">Collection Detail</h5>
      </div>
      <small class="text-muted"><i class="far fa-clock me-1"></i><span id="colTime"></span></small>
    </div>

    <div class="container-fluid py-4">
      <div class="detail-grid">
        <!-- Summary Panel -->
        <div class="panel">
          <div class="panel-head">
            <h6 class="m-0 fw-semibold"><i class="fas fa-box-open me-2 text-primary"></i>Summary</h6>
          </div>
            <div class="panel-body">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <div class="meta">
                    <div class="label">Donor</div>
                    <div class="value"><i class="fas fa-user text-secondary me-1"></i><%= collection.donor.firstName %> <%= collection.donor.lastName %></div>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="meta">
                    <div class="label">Food Type</div>
                    <div class="value"><span class="pill"><i class="fas fa-utensils me-1"></i><%= collection.foodType %></span></div>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="meta">
                    <div class="label">Quantity</div>
                    <div class="value"><span class="qty"><%= collection.quantity %></span></div>
                  </div>
                </div>
                <div class="col-6 col-md-4">
                  <div class="meta">
                    <div class="label">Cooked At</div>
                    <div class="value small"><%= collection.cookingTime.toLocaleString("en-IN",{ dateStyle:"medium", timeStyle:"short"}) %></div>
                  </div>
                </div>
                <div class="col-6 col-md-4">
                  <div class="meta">
                    <div class="label">Phone</div>
                    <div class="value"><i class="fas fa-phone text-secondary me-1"></i><%= collection.phone %></div>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div class="meta">
                    <div class="label">Status</div>
                    <div class="value">
                      <span class="status-badge <%= collection.status %>">
                        <i class="fas fa-circle me-1"></i><%= collection.status %>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="meta">
                    <div class="label">Address</div>
                    <div class="value small text-wrap"><i class="fas fa-location-dot text-danger me-1"></i><%= collection.address %></div>
                  </div>
                </div>
                <% if(collection.status === "assigned" && collection.adminToAgentMsg){ %>
                  <div class="col-12">
                    <div class="meta">
                      <div class="label">Admin Message</div>
                      <div class="note"><%= collection.adminToAgentMsg %></div>
                    </div>
                  </div>
                <% } %>
                <% if(collection.status === "collected"){ %>
                  <div class="col-12 col-md-6">
                    <div class="meta">
                      <div class="label">Collected At</div>
                      <div class="value small"><i class="fas fa-check-circle text-success me-1"></i><%= collection.collectionTime.toLocaleString("en-IN",{ dateStyle:"medium", timeStyle:"short"}) %></div>
                    </div>
                  </div>
                <% } %>
              </div>

              <div class="actions mt-4">
                <a href="/agent/collections/pending" class="btn btn-outline-secondary btn-sm"><i class="fas fa-arrow-left me-1"></i>Back</a>
                <% if(collection.status === "assigned"){ %>
                  <a href="/agent/collection/collect/<%= collection._id %>" class="btn btn-success btn-sm">
                    <i class="fas fa-check me-1"></i>Mark Collected
                  </a>
                <% } %>
              </div>
            </div>
        </div>

        <!-- Timeline Panel -->
        <div class="panel">
          <div class="panel-head">
            <h6 class="m-0 fw-semibold"><i class="fas fa-stream me-2 text-warning"></i>Timeline</h6>
          </div>
          <div class="panel-body">
            <ul class="timeline list-unstyled m-0">
              <li>
                <div class="dot bg-primary"></div>
                <div class="content">
                  <div class="title">Assigned</div>
                  <div class="time">Task created</div>
                </div>
              </li>
              <% if(collection.status === 'collected'){ %>
              <li>
                <div class="dot bg-success"></div>
                <div class="content">
                  <div class="title">Collected</div>
                  <div class="time"><%= collection.collectionTime.toLocaleString("en-IN",{ dateStyle:"medium", timeStyle:"short"}) %></div>
                </div>
              </li>
              <% } %>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>
</main>

<style>
.agent-collection { background:#f3f6fb; min-height:100vh; }
.top-bar { position:sticky; top:0; z-index:10; }
.detail-grid { display:grid; gap:1.25rem; grid-template-columns:repeat(auto-fit,minmax(340px,1fr)); }
.panel { background:#fff; border:1px solid #e5eaf1; border-radius:1rem; box-shadow:0 6px 18px -8px rgba(0,0,0,.08); }
.panel-head { padding:.85rem 1.1rem; border-bottom:1px solid #eef2f6; background:linear-gradient(90deg,#f8fafc,#f1f5f9); border-radius:1rem 1rem 0 0; }
.panel-body { padding:1.1rem 1.15rem 1.3rem; }
.meta .label { font-size:.6rem; text-transform:uppercase; letter-spacing:.75px; font-weight:700; color:#6b7280; }
.meta .value { font-weight:600; margin-top:.25rem; }
.meta .value.small { font-weight:500; font-size:.75rem; color:#374151; }
.pill { background:#eef5ff; color:#1d4ed8; padding:.4rem .7rem; border-radius:1.2rem; font-size:.65rem; font-weight:600; letter-spacing:.4px; }
.qty { background:#fff; border:1px solid #d9e2ec; padding:.4rem .65rem; border-radius:.7rem; font-size:.65rem; font-weight:600; }
.status-badge { display:inline-flex; align-items:center; gap:.35rem; padding:.4rem .75rem; font-size:.6rem; text-transform:uppercase; letter-spacing:1px; font-weight:700; border-radius:2rem; border:1px solid transparent; }
.status-badge.assigned { background:#ede9fe; color:#5b21b6; border-color:#ddd6fe; }
.status-badge.collected { background:#dcfce7; color:#065f46; border-color:#bbf7d0; }
.note { background:#f1f5f9; padding:.75rem .85rem; border-radius:.7rem; font-size:.75rem; border:1px solid #e2e8f0; }
.actions .btn { margin-right:.4rem; }
.timeline li { position:relative; padding-left:2.1rem; margin-bottom:1rem; }
.timeline li:last-child { margin-bottom:0; }
.timeline .dot { position:absolute; left:.4rem; top:.2rem; width:14px; height:14px; border-radius:50%; box-shadow:0 0 0 3px #fff; }
.timeline .content .title { font-size:.7rem; text-transform:uppercase; font-weight:700; letter-spacing:.7px; margin-bottom:.1rem; }
.timeline .content .time { font-size:.65rem; color:#64748b; }
@media (max-width: 575.98px){
  .detail-grid { grid-template-columns:1fr; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const t=document.getElementById('colTime');
  function upd(){ if(t) t.textContent=new Date().toLocaleString(); }
  upd(); setInterval(upd,60000);
});
</script>